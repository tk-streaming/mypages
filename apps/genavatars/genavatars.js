const json = '{     \"body\": {         \"vanilla\": \"<g class=\\"vanilla\\"><circle class=\\"silhouette defaultstroke basecolor\\" cx=\\"369\\" cy=\\"711\\" r=\\"369\\" /></g>\",         \"tk\": \"<g class=\\"tk\\"><path class=\\"silhouette defaultstroke basecolor\\" d=\\"m369,352.24c-.24,0-17.22-.14-17-.24,69-30,38-76,38-76-15,32-41,41-41,41-6-25-26-38-26-38,10,38-50.46,84.51-79.38,94.81C101.55,424.42,0,558.57,0,716.12c0,200.97,165.21,363.88,369,363.88s369-162.91,369-363.88-165.21-363.88-369-363.88Z\\" /></g>\",         \"sg\": \"<g class=\\"sg\\"><path class=\\"silhouette defaultstroke basecolor\\" d=\\"m477,238c-8,4-68,97-68,97-11-63-59-102-59-102,0,62.2-48,110-48,110-4-71-64-90-64-90,12,56-44.84,142.04-67.67,156.46C67.9,474.11,0,587.29,0,716.12c0,200.97,165.21,363.88,369,363.88s369-162.91,369-363.88c0-135.12-86.31-235.9-185.56-315.8-51.88-41.76-75.44-162.32-75.44-162.32Z\\" /></g>\",         \"suwa\": \"<g class=\\"suwa\\"><path class=\\"cap2 defaultstroke accentcolor\\" d=\\"m412,285c22.29,19.81-323.35,271.16-354,253-27-16-50.59-68.39-47-98,12-99,308.69-224.63,342-212,29,11,32,33,59,57Z\\" /><ellipse class=\\"silhouette defaultstroke basecolor\\" cx=\\"369\\" cy=\\"716\\" rx=\\"369\\" ry=\\"364\\" /><path class=\\"cap1 defaultstroke accentcolor\\" d=\\"m575,309c-4-35-22-50-87-42-211.76,26.06-360.41,177.72-348,164,38-42,196-112,383-46,37.3,13.17,54.1-57.62,52-76Z\\" /></g>\",         \"ino\": \"<g class=\\"ino\\"><ellipse class=\\"silhouette defaultstroke basecolor\\" cx=\\"369\\" cy=\\"716\\" rx=\\"369\\" ry=\\"364\\" /><path class=\\"hair defaultstroke basecolor\\" d=\\"m367.86,290.51c-164.72,34.37-161.72,116.37-303.53,126.63,51.2,24.84,115.93,18.93,161.79-14.77-9.32,22.65-18.63,45.3-27.95,67.95,36.43-34.98,76.88-69.23,126.13-80.46-3.36,6.25-4.66,13.37-7.11,20.03-7.33,19.97-24.1,41.25-45.05,44.99,16.53,7.27,129.17-40.43,156.49-70.55,14.48-15.97,24.75-36.65,21.83-57.93s-29.34-47.01-82.6-35.89Z\\" /></g>\",         \"sukirobo\": \"<g class=\\"sukirobo\\"><path class=\\"defaultstroke basecolor\\" d=\\"m738,716c0,201.03-165.21,364-369,364S0,917.03,0,716c0-158.55,102.76-293.42,246.17-343.35,5.62-1.95,23.85-248.14,137.85-252.14,55-1.93,55,81,55,103,0,0,39.15-71.02,83-45,59,35,10,121,10,121,0,0,44.28-26.02,65-8,23,20-4,68-56.94,92.33-12.18,5.6,15.8,18.2,18.75,19.95,107.35,63.65,179.18,179.65,179.18,312.21Z\\" /></g>\"     },      \"eyes\": {         \"vanilla\": \"<g class=\\"vanilla\\"><ellipse cx=\\"478.9\\" cy=\\"191.12\\" rx=\\"14.47\\" ry=\\"35.36\\" transform=\\"translate(-32.35 124.1) rotate(-14.29)\\" /><ellipse cx=\\"295.12\\" cy=\\"221.69\\" rx=\\"14.47\\" ry=\\"34.17\\" transform=\\"translate(-32.56 51.78) rotate(-9.5)\\" /></g>\",         \"tk\": \"<g class=\\"tk\\"><path class=\\"defaultstroke\\" style=\\"fill: none\\" d=\\"m581,133c-11,6-29.84,18.29-44,24-25.58,10.32-47.43,17.84-73.85,25.61\\" /><path class=\\"defaultstroke\\" style=\\"fill: none\\" d=\\"m168.12,265.78c25.25,1,49.51,1.29,72.88-2.78,24.19-4.21,48.85-11.77,69-28\\" /></g>\",         \"sg\": \"<g class=\\"sg\\"><circle cx=\\"498\\" cy=\\"213\\" r=\\"10\\" /><circle cx=\\"325\\" cy=\\"250\\" r=\\"10\\" /></g>\",         \"suwa\": \"<g class=\\"suwa\\"><ellipse cx=\\"507.66\\" cy=\\"179.96\\" rx=\\"50\\" ry=\\"14.47\\" transform=\\"translate(-22.71 86.1) rotate(-9.48)\\" /><ellipse cx=\\"276.65\\" cy=\\"243.86\\" rx=\\"50\\" ry=\\"14.47\\" transform=\\"translate(-80.73 152.86) rotate(-27.11)\\" /></g>\",         \"ino\": \"<g class=\\"ino\\"><ellipse class=\\"defaultstroke\\" style=\\"fill: #fff;\\" cx=\\"483.48\\" cy=\\"167.65\\" rx=\\"45.52\\" ry=\\"45.5\\" transform=\\"translate(-26.01 215.39) rotate(-24.48)\\" /><ellipse cx=\\"485.97\\" cy=\\"173.65\\" rx=\\"27\\" ry=\\"36.5\\" transform=\\"translate(-28.27 216.96) rotate(-24.48)\\" /><ellipse style=\\"fill: #fff;\\" cx=\\"472.3\\" cy=\\"164.66\\" rx=\\"13.48\\" ry=\\"14.75\\" transform=\\"translate(-26.03 121.65) rotate(-14.29)\\" /><line class=\\"defaultstroke\\" style=\\"fill: none;\\" x1=\\"530\\" y1=\\"185\\" x2=\\"542\\" y2=\\"189\\" /><line class=\\"defaultstroke\\" style=\\"fill: none;\\" x1=\\"536\\" y1=\\"205\\" x2=\\"521.97\\" y2=\\"189.15\\" /><ellipse class=\\"defaultstroke\\" style=\\"fill: #fff;\\" cx=\\"302.97\\" cy=\\"224.65\\" rx=\\"50\\" ry=\\"45.5\\" /><ellipse cx=\\"316.97\\" cy=\\"224.65\\" rx=\\"27\\" ry=\\"36.5\\" /><ellipse style=\\"fill: #fff;\\" cx=\\"307.3\\" cy=\\"213.66\\" rx=\\"14.75\\" ry=\\"13.48\\" transform=\\"translate(-31.39 372.96) rotate(-60)\\" /><line class=\\"defaultstroke\\" style=\\"fill: none\\" x1=\\"263.97\\" y1=\\"253.15\\" x2=\\"245.97\\" y2=\\"264.15\\" /><line class=\\"defaultstroke\\" style=\\"fill: none\\" x1=\\"268.97\\" y1=\\"281.15\\" x2=\\"271.97\\" y2=\\"257.15\\" /></g>\",         \"sukirobo\": \"<g class=\\"sukirobo\\"><path class=\\"defaultstroke\\" style=\\"fill: none\\" d=\\"m466.14,184.8c3.21-11.36,8.1-22.69,16.81-30.65,13.67-12.5,35.36-14.19,51.95-5.95,16.59,8.24,27.97,25.17,31.78,43.29\\" /><path class=\\"defaultstroke\\" style=\\"fill: none\\" d=\\"m243.69,258.87c-2.79-9.61-4.99-19.55-4.45-29.54.54-9.99,4.1-20.13,11.38-26.99,3.61-3.4,7.98-5.88,12.43-8.07,12.69-6.22,27.38-10.31,40.92-6.27,11.3,3.36,20.71,12.5,24.4,23.7\\" /></g>\"     } }'

const skelton = '<?xml version="1.0" encoding="UTF-8"?> <svg xmlns="http://www.w3.org/2000/svg" width="374px" height="243px" viewBox="0 0 1496 970">     <defs>         <style>             .defaultstroke { stroke: #000; stroke-miterlimit: 10; stroke-width: 10px; }             .basecolor { fill: [[basecolor]]; }             .accentcolor { fill: [[accentcolor]]; }         </style>     </defs>     <svg id="closed" viewBox="369 115 748 970">         <g class="body">[[body]]</g>         <svg class="inbody" width="738" height="1422" viewBox="0 0 738 738">             <g id="eyes">[[eyes]]</g>             <g id="wings">                 <path class="defaultstroke accentcolor" d="m482,502c-22.06,13.2,78,18,105-5,3-2-69,56-54,63,12.59,2.91,58.96-24.17,70.05-32.28.18-.13.27.05.28.27.68,16.01-22.32,50.01-11.32,55.01,189-76,46.5-343.44,50-316,12,94-18,150-160,235Z" />                 <path class="defaultstroke accentcolor" d="m450,502c14.6,0,36.3,11.44-22,38-29.68,13.52-97.71,18.88-107.04,15.55-16.62-2.49,87.89,16.32,72.04,35.45-26.17,31.58-92.24,2.09-107.09-6.9-1.01-.61-2.05.72-1.22,1.56,9.87,9.91,57.79,23.26,38.31,30.34-59,18-133.63-69.44-138-75-73-93-73.49-158.13-71-155,14.49,18.17,175.2,115.99,336,116Z" />             </g>             <g id="beak">                 <path style="fill: #ff0;" d="m452.11,406.64c-1.94,0-3.84-.38-5.65-1.14l-88.52-37.12c-3.89-1.63-6.88-4.86-8.22-8.86-1.33-4-.87-8.38,1.26-12.02l55.57-94.75c2.65-4.53,7.38-7.23,12.64-7.23,3.15,0,6.17,1,8.72,2.9l81.37,60.67c6.29,4.69,7.77,13.45,3.35,19.95l-48.42,71.2c-2.73,4.01-7.25,6.4-12.1,6.4h0Z" />                 <path d="m419.19,250.53c2.07,0,4.05.66,5.73,1.91l81.37,60.67c4.14,3.09,5.11,8.85,2.21,13.13l-48.41,71.2c-1.79,2.64-4.77,4.21-7.96,4.21-1.28,0-2.53-.25-3.71-.75l-88.52-37.12c-2.6-1.09-4.52-3.16-5.41-5.83-.89-2.67-.6-5.48.83-7.91l55.57-94.75c1.75-2.98,4.86-4.76,8.33-4.76m0-10c-6.7,0-13.27,3.42-16.95,9.7l-55.57,94.75c-6.01,10.24-1.61,23.43,9.34,28.02l88.52,37.12c2.46,1.03,5.04,1.53,7.58,1.53,6.34,0,12.49-3.08,16.23-8.59l48.41-71.2c5.91-8.69,3.92-20.49-4.5-26.77l-81.37-60.67c-3.54-2.64-7.64-3.89-11.7-3.89h0Z" />                 <line class="defaultstroke" style="fill: none" x1="351.32" y1="359.32" x2="512.32" y2="318.32" />             </g>         </svg>     </svg>     <svg id="opened" viewBox="-379 115 748 970">         <g class="body">[[body]]</g>         <svg class="inbody" width="738" height="1422" viewBox="0 0 738 738">             <g id="eyes">[[eyes]]</g>             <g id="wings">                 <path class="defaultstroke accentcolor" d="m482,502c-22.06,13.2,78,18,105-5,3-2-69,56-54,63,12.59,2.91,58.96-24.17,70.05-32.28.18-.13.27.05.28.27.68,16.01-22.32,50.01-11.32,55.01,189-76,46.5-343.44,50-316,12,94-18,150-160,235Z" />                 <path class="defaultstroke accentcolor" d="m450,502c14.6,0,36.3,11.44-22,38-29.68,13.52-97.71,18.88-107.04,15.55-16.62-2.49,87.89,16.32,72.04,35.45-26.17,31.58-92.24,2.09-107.09-6.9-1.01-.61-2.05.72-1.22,1.56,9.87,9.91,57.79,23.26,38.31,30.34-59,18-133.63-69.44-138-75-73-93-73.49-158.13-71-155,14.49,18.17,175.2,115.99,336,116Z" />             </g>             <g id="beak">                 <path style="fill: #ff0;" d="m453.72,423.03c-1.56,0-3.11-.4-4.49-1.17l-99.34-55.17c-4.42-2.46-6.06-7.9-3.72-12.38l61.07-117.26c1.6-3.08,4.76-4.99,8.24-4.99,2.18,0,4.23.75,5.92,2.16l93.46,78.19c3.48,2.91,4.35,7.87,2.05,11.79l-55.18,94.23c-1.66,2.83-4.73,4.59-8.01,4.59Z" />                 <path d="m415.48,237.06c.69,0,1.73.17,2.71,1l93.46,78.19c1.6,1.34,2,3.63.94,5.43l-55.18,94.23c-.77,1.32-2.16,2.11-3.7,2.11-.72,0-1.42-.18-2.06-.54l-99.34-55.17c-2.04-1.13-2.79-3.64-1.71-5.7l61.07-117.26c1.11-2.13,3.2-2.3,3.81-2.3m0-10c-5.09,0-10.09,2.71-12.68,7.68l-61.07,117.26c-3.57,6.86-1.03,15.31,5.73,19.06l99.34,55.17c2.19,1.22,4.57,1.8,6.91,1.8,4.91,0,9.67-2.53,12.32-7.06l55.18-94.23c3.52-6.01,2.18-13.68-3.16-18.15l-93.46-78.19c-2.7-2.26-5.93-3.33-9.13-3.33h0Z" />                 <path style="fill: red" d="m440.8,377.46c-.41,0-.83-.03-1.24-.09l-83.54-12.13c-4.3-.62-6.51-3.81-7.15-6.59-.64-2.78-.04-6.61,3.56-9.05l62.91-42.6c1.43-.97,3.1-1.48,4.82-1.48.26,0,.52.01.78.04l81.72,7.43c3.65.33,6.45,2.63,7.48,6.16s-.09,6.97-2.99,9.21l-61.09,47.29c-1.5,1.16-3.37,1.8-5.27,1.8h0Z" />                 <path d="m420.16,310.53c.11,0,.22,0,.33.01l81.72,7.43c2.13.19,2.88,1.7,3.13,2.58.26.88.44,2.55-1.25,3.86l-61.09,47.29c-.63.49-1.41.75-2.21.75-.17,0-.35-.01-.52-.04l-83.54-12.13c-2.12-.31-2.79-1.86-2.99-2.76-.21-.9-.29-2.58,1.49-3.79l62.91-42.6c.6-.41,1.3-.62,2.02-.62m0-10c-2.71,0-5.37.81-7.63,2.34l-62.91,42.6c-10.29,6.97-6.62,22.94,5.67,24.73l83.54,12.13c.65.09,1.3.14,1.95.14,3,0,5.93-.99,8.33-2.85l61.09-47.29c9.77-7.56,5.21-23.18-7.1-24.3l-81.72-7.43c-.41-.04-.82-.06-1.23-.06h0Z" />             </g>         </svg>     </svg> </svg>'

function buildAvatar() {
    const parts = JSON.parse(json)
    const body = [ "vanilla", "tk", "sg", "suwa", "ino", "sukirobo" ].sort(() => Math.random() - 0.5)[0]
    const eye = [ "vanilla", "tk", "sg", "suwa", "ino", "sukirobo" ].sort(() => Math.random() - 0.5)[0]
    const r = Math.floor(Math.random() * 205)
    const g = Math.floor(Math.random() * 205)
    const b = Math.floor(Math.random() * 205)
    const basecolor = "#" + ('0' + (r+50).toString(16)).slice(-2) + ('0' + (g+50).toString(16)).slice(-2) + ('0' + (b+50).toString(16)).slice(-2)
    const accentcolor = "#" + ('0' + r.toString(16)).slice(-2) + ('0' + g.toString(16)).slice(-2) + ('0' + b.toString(16)).slice(-2)
    const s = skelton
        .replace(/\[\[body\]\]/g, parts["body"][body])
        .replace(/\[\[eyes\]\]/g, parts["eyes"][eye])
        .replace(/\[\[basecolor\]\]/g, basecolor)
        .replace(/\[\[accentcolor\]\]/g, accentcolor)
    return `data:image/svg+xml;charset=utf8,${encodeURIComponent(s)}`
}

window.addEventListener('load', () => {
    for(var i=0; i<120; i++) {
        const svg = buildAvatar()
        var avatar = document.createElement("div")
        avatar.classList.add("avatar")
        avatar.classList.add("speaking")
        avatar.style.backgroundImage = `url('${svg}')`
        document.getElementById("avatars").appendChild(avatar)
    }
});
